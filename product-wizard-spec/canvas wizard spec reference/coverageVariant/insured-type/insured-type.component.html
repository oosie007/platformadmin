<div class="insured-type__container">
  <form [formGroup]="individualInsuredForm">
    <!-- <div class="
        insured-type__title">Individual Insured
    </div> -->

    <div class="insured-type__insured-container">
      <div formGroupName="typeSelectionForm">
        <div class="insured-type__toggle-layout">
          <div class="insured-type__toggle">
            <div
              cbToggle
              color="default"
              toggleOnText="Include beneficiary"
              toggleOffText="Include beneficiary"
              [showIcons]="true"
            >
              <input
                type="checkbox"
                (change)="toggleBeneficiary()"
                formControlName="includeBeneficiary"
              />
            </div>
            <div class="insured-type__toggle-text">
              Turning on this option makes including the beneficiary a required
              input for the policy
            </div>
          </div>
          <div class="insured-type__toggle">
            <div
              cbToggle
              color="default"
              toggleOnText="Rate as individuals"
              toggleOffText="Rate as individuals"
              [showIcons]="true"
            >
              <input type="checkbox" formControlName="individuallyRated" />
            </div>
            <div class="insured-type__toggle-text">
              Turning on this option enables you to rate insureds individually.
              Otherwise, you can only rate insureds as a group.
            </div>
          </div>
        </div>

        <div class="insured-type__main-insured-wrapper">
          <div
            class="insured-type__main-insured-select"
            [cbSelectMultiple]="selectMultipleInsured"
            [errorMessage]="
              insuredType.invalid && (insuredType.dirty || insuredType.touched)
                ? 'Required field'
                : null
            "
          >
            <label class="insured-type__main-insured-label">Insured type</label>
            <p-multiSelect
              #selectMultipleInsured
              [selectAll]="selectAllInsured"
              [options]="insuredList"
              optionLabel="description"
              [(ngModel)]="selectedInsuredTypes"
              placeholder="Insured type"
              inputId="#selectMultipleInsured"
              formControlName="insuredType"
              (onChange)="onMultiSelectChange($event, 'insuredType')"
              (onSelectAllChange)="
                onMultiSelectSelectAllChange($event, 'insuredType')
              "
            ></p-multiSelect>
          </div>
          <div
            class="insured-type__main-insured-chips-container"
            *ngIf="insuredType?.value?.length > 0"
          >
            <p-chips
              fieldVariant="stroke"
              class="insured-type__main-insured-chips"
              field="description"
              formControlName="insuredTypeChipControl"
              (onRemove)="onChipRemove($event, 'insuredType')"
            ></p-chips>
            <button
              cbButton
              label="Clear all selection"
              [disabled]="disableMIClrSelection"
              variant="primary"
              (click)="clearSelection('insuredType')"
            ></button>
          </div>
        </div>

        <div
          class="insured-type__dependant-wrapper"
          *ngIf="isDependantSelected"
        >
          <div
            class="insured-type__dependant-select"
            [cbSelectMultiple]="selectMultipleDependant"
            [errorMessage]="
              dependantType.invalid &&
              (dependantType.dirty || dependantType.touched)
                ? 'Required field'
                : null
            "
          >
            <label class="insured-type__dependant-label">Dependent type</label>
            <p-multiSelect
              #selectMultipleDependant
              [selectAll]="selectAllDependant"
              class="insured-type__dependant--multi-select"
              [options]="dependantList"
              optionLabel="description"
              [(ngModel)]="selectedDependantTypes"
              placeholder="Dependent type"
              inputId="#selectMultipleDependant"
              formControlName="dependantType"
              (onChange)="onMultiSelectChange($event, 'dependantType')"
              (onSelectAllChange)="
                onMultiSelectSelectAllChange($event, 'dependantType')
              "
              [readonly]="disableEdit"
            >
            </p-multiSelect>
          </div>
          <div
            class="insured-type__dependant-chips-container"
            *ngIf="dependantType?.value?.length > 0"
          >
            <p-chips
              fieldVariant="stroke"
              class="insured-type__dependant-chips"
              field="description"
              formControlName="dependantTypeChipControl"
              (onRemove)="onChipRemove($event, 'dependantType')"
            ></p-chips>
            <button
              cbButton
              label="Clear all selection"
              [disabled]="disableDPClrSelection"
              variant="primary"
              (click)="clearSelection('dependantType')"
            ></button>
          </div>
        </div>

        <div *ngIf="isBeneficiaryIncluded">
          <div
            cbInput
            label="Define Maximum Beneficiaries"
            styleVariant="default"
          >
            <input
              placeholder="Enter number here"
              type="number"
              pattern=".*"
              maxLength="50"
              formControlName="maxBeneficiariesAllowed"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="insured-type__main-insured-wrapper">
      <div
        cbSelectChoice
        class="insured-type__dropdown-label"
        label="Overage cancellation"
        styleVariant="default"
        placeholder="Overage cancellation"
        [errorMessage]="''"
      >
        <select formControlName="overAgeCancellation">
          <option
            *ngFor="let type of overAgeCancellationTypes | inputUnselect"
            [ngValue]="type.code"
          >
            {{ type.description }}
          </option>
        </select>
      </div>
    </div>

    <div class="insured-type__accordions-wrapper">
      <p-accordion [multiple]="true" [activeIndex]="[0]">
        <p-accordionTab header="Main insured" *ngIf="isMainInsuredSelected">
          <div class="insured-type__accordions-form">
            <div formGroupName="mainInsuredForm">
              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum count"
                  styleVariant="default"
                  helpText=""
                >
                  <input
                    placeholder="Minimum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="minCount"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum count"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxCount('MI')"
                >
                  <input
                    placeholder="Maximum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="maxCount"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMinAge('MI')"
                >
                  <input
                    placeholder="Minimum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="minAge"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxAge('MI')"
                >
                  <input
                    placeholder="Maximum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="maxAge"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Renewal age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateRenewalAge('MI')"
                >
                  <input
                    placeholder="Renewal age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="renewalAge"
                  />
                </div>
              </div>
              <div class="insured-type__main-insured-wrapper">
                <div
                  class="insured-type__main-insured-select"
                  [errorMessage]="
                    getPredefinedAttributeNameErrorMessage(
                      mainInsuredForm.get('predefinedAttribute')
                    )
                  "
                  [cbSelectMultiple]="selectPredefinedAttribute"
                >
                  <div class="insured-type__tooltip">
                    <label class="insured-type__main-insured-label"
                      >Predefined attributes</label
                    >
                    <div class="insured-type__tooltiptextpa">
                      <cb-tooltip
                        explanationText="Unique characteristics of the insured which can impact product eligibility & pricing. These are typically pre-defined in the master reference data."
                        styleVariant="stroke"
                        [colorTheme]="cbToolTipColorTheme"
                        direction="above-right"
                      >
                        <cb-icon iconKey="utility-tooltip-stroke"></cb-icon>
                      </cb-tooltip>
                    </div>
                  </div>
                  <p-multiSelect
                    #selectPredefinedAttribute
                    optionDisabled="inactive"
                    [selectAll]="selectAllPredefinedAttributes['MI']"
                    [options]="miPredefAttr"
                    optionLabel="description"
                    placeholder="Define predefined attributes"
                    inputId="#selectPredefinedAttribute"
                    formControlName="predefinedAttribute"
                    (onChange)="
                      onMultiSelectChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'MI',
                        mainInsuredForm
                      )
                    "
                    (onSelectAllChange)="
                      onMultiSelectSelectAllChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'MI',
                        mainInsuredForm
                      )
                    "
                    [readOnly]="disableEdit"
                  ></p-multiSelect>
                </div>
                <div
                  class="insured-type__main-insured-chips-container"
                  *ngIf="
                    mainInsuredForm.get('predefinedAttribute')?.value?.length >
                    0
                  "
                >
                  <p-chips
                    fieldVariant="stroke"
                    class="insured-type__main-insured-chips"
                    field="description"
                    formControlName="predefinedTypeChipControl"
                    [readOnly]="disableEdit"
                    (onRemove)="
                      onChipRemove(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'MI',
                        mainInsuredForm
                      )
                    "
                  ></p-chips>
                  <button
                    cbButton
                    label="Clear all selection"
                    variant="primary"
                    (click)="
                      clearSelection(
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'MI',
                        mainInsuredForm
                      )
                    "
                    [disabled]="disableEdit"
                  ></button>
                </div>
              </div>

              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  mainInsuredForm.get('predefinedAttribute')?.value?.length > 0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Required Attributes
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="requiredAttributesList['MI']"
                    formControlName="requiredAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  >
                  </cb-multi-checkbox>
                </div>
              </div>
              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  mainInsuredForm.get('predefinedAttribute')?.value?.length > 0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Do Not Allow Duplicates
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="noDuplicatesList['MI']"
                    formControlName="doNotAllowDuplicateAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  ></cb-multi-checkbox>
                </div>
              </div>
            </div>
          </div>
        </p-accordionTab>

        <p-accordionTab header="Spouse" *ngIf="isSpouseSelected">
          <div class="insured-type__accordions-form">
            <div formGroupName="spouseInsuredForm">
              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum count"
                  styleVariant="default"
                  helpText=""
                >
                  <input
                    placeholder="Minimum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="minCount"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum count"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxCount('SP')"
                >
                  <input
                    placeholder="Maximum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="maxCount"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMinAge('SP')"
                >
                  <input
                    placeholder="Minimum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="minAge"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxAge('SP')"
                >
                  <input
                    placeholder="Maximum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="maxAge"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Renewal age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateRenewalAge('SP')"
                >
                  <input
                    placeholder="Renewal age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="renewalAge"
                  />
                </div>
              </div>

              <div class="insured-type__main-insured-wrapper">
                <div
                  class="insured-type__main-insured-select"
                  [errorMessage]="
                    getPredefinedAttributeNameErrorMessage(
                      spouseInsuredForm.get('predefinedAttribute')
                    )
                  "
                  [cbSelectMultiple]="selectPredefinedAttribute"
                >
                  <div class="insured-type__tooltip">
                    <label class="insured-type__main-insured-label"
                      >Predefined attributes</label
                    >
                    <div class="insured-type__tooltiptextpa">
                      <cb-tooltip
                        explanationText="Unique characteristics of the insured which can impact product eligibility & pricing. These are typically pre-defined in the master reference data."
                        styleVariant="stroke"
                        [colorTheme]="cbToolTipColorTheme"
                        direction="above-right"
                      >
                        <cb-icon iconKey="utility-tooltip-stroke"></cb-icon>
                      </cb-tooltip>
                    </div>
                  </div>
                  <p-multiSelect
                    #selectPredefinedAttribute
                    optionDisabled="inactive"
                    [selectAll]="selectAllPredefinedAttributes['SP']"
                    [options]="spPredefAttr"
                    optionLabel="description"
                    placeholder="Define predefined attributes"
                    inputId="#selectPredefinedAttribute"
                    formControlName="predefinedAttribute"
                    (onChange)="
                      onMultiSelectChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'SP',
                        spouseInsuredForm
                      )
                    "
                    (onSelectAllChange)="
                      onMultiSelectSelectAllChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'SP',
                        spouseInsuredForm
                      )
                    "
                    [readOnly]="disableEdit"
                  ></p-multiSelect>
                </div>
                <div
                  class="insured-type__main-insured-chips-container"
                  *ngIf="
                    spouseInsuredForm.get('predefinedAttribute')?.value
                      ?.length > 0
                  "
                >
                  <p-chips
                    fieldVariant="stroke"
                    class="insured-type__main-insured-chips"
                    field="description"
                    formControlName="predefinedTypeChipControl"
                    [readOnly]="disableEdit"
                    (onRemove)="
                      onChipRemove(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'SP',
                        spouseInsuredForm
                      )
                    "
                  ></p-chips>
                  <button
                    cbButton
                    label="Clear all selection"
                    variant="primary"
                    (click)="
                      clearSelection(
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'SP',
                        spouseInsuredForm
                      )
                    "
                    [disabled]="disableEdit"
                  ></button>
                </div>
              </div>

              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  spouseInsuredForm.get('predefinedAttribute')?.value?.length >
                  0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Required Attributes
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="requiredAttributesList['SP']"
                    formControlName="requiredAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  >
                  </cb-multi-checkbox>
                </div>
              </div>
              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  spouseInsuredForm.get('predefinedAttribute')?.value?.length >
                  0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Do Not Allow Duplicates
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="noDuplicatesList['SP']"
                    formControlName="doNotAllowDuplicateAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  ></cb-multi-checkbox>
                </div>
              </div>
            </div>
          </div>
        </p-accordionTab>

        <p-accordionTab
          header="Dependent-Child"
          *ngIf="isDependantChildSelected"
        >
          <div class="insured-type__accordions-form">
            <div formGroupName="dependantChildForm">
              <div class="insured-type__accordions-form-toggle">
                <div
                  cbToggle
                  color="default"
                  toggleOnText="Rate as group"
                  toggleOffText="Rate as group"
                  [showIcons]="true"
                >
                  <input type="checkbox" formControlName="rateAsGroup" />
                </div>
                <div class="insured-type__accordions-form-toggle-text">
                  Turning on this option enables you to rate insureds as a
                  group. Otherwise, you can only rate dependents individually.
                </div>
                <div class="insured-type__accordions-form-toggle-text">
                  Toggle between rating as group of dependant or as inviduals.
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum count"
                  styleVariant="default"
                  helpText=""
                >
                  <input
                    placeholder="Minimum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="minCount"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum count"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxCount('DPCHILD')"
                >
                  <input
                    placeholder="Maximum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="maxCount"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMinAge('DPCHILD')"
                >
                  <input
                    placeholder="Minimum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="minAge"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxAge('DPCHILD')"
                >
                  <input
                    placeholder="Maximum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="maxAge"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Renewal age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateRenewalAge('DPCHILD')"
                >
                  <input
                    placeholder="Renewal age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="renewalAge"
                  />
                </div>
              </div>
              <div class="insured-type__main-insured-wrapper">
                <div
                  class="insured-type__main-insured-select"
                  [errorMessage]="
                    getPredefinedAttributeNameErrorMessage(
                      dependantChildForm.get('predefinedAttribute')
                    )
                  "
                  [cbSelectMultiple]="selectPredefinedAttribute"
                >
                  <div class="insured-type__tooltip">
                    <label class="insured-type__main-insured-label"
                      >Predefined attributes</label
                    >
                    <div class="insured-type__tooltiptextpa">
                      <cb-tooltip
                        explanationText="Unique characteristics of the insured which can impact product eligibility & pricing. These are typically pre-defined in the master reference data."
                        styleVariant="stroke"
                        [colorTheme]="cbToolTipColorTheme"
                        direction="above-right"
                      >
                        <cb-icon iconKey="utility-tooltip-stroke"></cb-icon>
                      </cb-tooltip>
                    </div>
                  </div>
                  <p-multiSelect
                    #selectPredefinedAttribute
                    optionDisabled="inactive"
                    [selectAll]="selectAllPredefinedAttributes['DPCHILD']"
                    [options]="dpChildPredefAttr"
                    optionLabel="description"
                    placeholder="Define predefined attributes"
                    inputId="#selectPredefinedAttribute"
                    formControlName="predefinedAttribute"
                    (onChange)="
                      onMultiSelectChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPCHILD',
                        dependantChildForm
                      )
                    "
                    (onSelectAllChange)="
                      onMultiSelectSelectAllChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPCHILD',
                        dependantChildForm
                      )
                    "
                    [readOnly]="disableEdit"
                  ></p-multiSelect>
                </div>
                <div
                  class="insured-type__main-insured-chips-container"
                  *ngIf="
                    dependantChildForm.get('predefinedAttribute')?.value
                      ?.length > 0
                  "
                >
                  <p-chips
                    fieldVariant="stroke"
                    class="insured-type__main-insured-chips"
                    field="description"
                    formControlName="predefinedTypeChipControl"
                    [readOnly]="disableEdit"
                    (onRemove)="
                      onChipRemove(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPCHILD',
                        dependantChildForm
                      )
                    "
                  ></p-chips>
                  <button
                    cbButton
                    label="Clear all selection"
                    variant="primary"
                    (click)="
                      clearSelection(
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPCHILD',
                        dependantChildForm
                      )
                    "
                    [disabled]="disableEdit"
                  ></button>
                </div>
              </div>

              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  dependantChildForm.get('predefinedAttribute')?.value?.length >
                  0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Required Attributes
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="requiredAttributesList['DPCHILD']"
                    formControlName="requiredAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  >
                  </cb-multi-checkbox>
                </div>
              </div>
              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  dependantChildForm.get('predefinedAttribute')?.value?.length >
                  0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Do Not Allow Duplicates
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="noDuplicatesList['DPCHILD']"
                    formControlName="doNotAllowDuplicateAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  ></cb-multi-checkbox>
                </div>
              </div>
            </div>
          </div>
        </p-accordionTab>

        <p-accordionTab
          header="Dependent-Adult"
          *ngIf="isDependantAdultSelected"
        >
          <div class="insured-type__accordions-form">
            <div formGroupName="dependantAdultForm">
              <div class="insured-type__accordions-form-toggle">
                <div
                  cbToggle
                  color="default"
                  toggleOnText="Rate as group"
                  toggleOffText="Rate as group"
                  [showIcons]="true"
                >
                  <input type="checkbox" formControlName="rateAsGroup" />
                </div>
                <div class="insured-type__accordions-form-toggle-text">
                  Toggle between rating as group of dependant or as inviduals.
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum count"
                  styleVariant="default"
                  helpText=""
                >
                  <input
                    placeholder="Minimum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="minCount"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum count"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxCount('DPADULT')"
                >
                  <input
                    placeholder="Maximum count"
                    type="number"
                    pattern=".*"
                    maxLength="50"
                    formControlName="maxCount"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Minimum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMinAge('DPADULT')"
                >
                  <input
                    placeholder="Minimum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="minAge"
                  />
                </div>

                <div
                  cbInput
                  label="Maximum age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateMaxAge('DPADULT')"
                >
                  <input
                    placeholder="Maximum age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="maxAge"
                  />
                </div>
              </div>

              <div class="insured-type__accordions-form-row">
                <div
                  cbInput
                  label="Renewal age"
                  styleVariant="default"
                  helpText=""
                  [errorMessage]="_validateRenewalAge('DPADULT')"
                >
                  <input
                    placeholder="Renewal age"
                    type="number"
                    pattern=".*"
                    maxLength="2"
                    formControlName="renewalAge"
                  />
                </div>
              </div>

              <div class="insured-type__main-insured-wrapper">
                <div
                  class="insured-type__main-insured-select"
                  [errorMessage]="
                    getPredefinedAttributeNameErrorMessage(
                      dependantAdultForm.get('predefinedAttribute')
                    )
                  "
                  [cbSelectMultiple]="selectPredefinedAttribute"
                >
                  <div class="insured-type__tooltip">
                    <label class="insured-type__main-insured-label"
                      >Predefined attributes</label
                    >
                    <div class="insured-type__tooltiptextpa">
                      <cb-tooltip
                        explanationText="Unique characteristics of the insured which can impact product eligibility & pricing. These are typically pre-defined in the master reference data."
                        styleVariant="stroke"
                        [colorTheme]="cbToolTipColorTheme"
                        direction="above-right"
                      >
                        <cb-icon iconKey="utility-tooltip-stroke"></cb-icon>
                      </cb-tooltip>
                    </div>
                  </div>
                  <p-multiSelect
                    #selectPredefinedAttribute
                    optionDisabled="inactive"
                    [selectAll]="selectAllPredefinedAttributes['DPADULT']"
                    [options]="dpAdultPredefAttr"
                    optionLabel="description"
                    placeholder="Define predefined attributes"
                    inputId="#selectPredefinedAttribute"
                    formControlName="predefinedAttribute"
                    (onChange)="
                      onMultiSelectChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPADULT',
                        dependantAdultForm
                      )
                    "
                    (onSelectAllChange)="
                      onMultiSelectSelectAllChange(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPADULT',
                        dependantAdultForm
                      )
                    "
                    [readOnly]="disableEdit"
                  ></p-multiSelect>
                </div>
                <div
                  class="insured-type__main-insured-chips-container"
                  *ngIf="
                    dependantAdultForm.get('predefinedAttribute')?.value
                      ?.length > 0
                  "
                >
                  <p-chips
                    fieldVariant="stroke"
                    class="insured-type__main-insured-chips"
                    field="description"
                    formControlName="predefinedTypeChipControl"
                    [readOnly]="disableEdit"
                    (onRemove)="
                      onChipRemove(
                        $event,
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPADULT',
                        dependantAdultForm
                      )
                    "
                  ></p-chips>
                  <button
                    cbButton
                    label="Clear all selection"
                    variant="primary"
                    (click)="
                      clearSelection(
                        insuredFormTypes.PREDEFINEDATTRIBUTE,
                        'DPADULT',
                        dependantAdultForm
                      )
                    "
                    [disabled]="disableEdit"
                  ></button>
                </div>
              </div>

              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  dependantAdultForm.get('predefinedAttribute')?.value?.length >
                  0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Required Attributes
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="requiredAttributesList['DPADULT']"
                    formControlName="requiredAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  >
                  </cb-multi-checkbox>
                </div>
              </div>
              <div
                class="insured-type__accordions-form-container"
                *ngIf="
                  dependantAdultForm.get('predefinedAttribute')?.value?.length >
                  0
                "
              >
                <div class="insured-type__accordions-form-row__title">
                  Do Not Allow Duplicates
                </div>
                <div class="insured-type__accordions-form-multi-checkbox">
                  <cb-multi-checkbox
                    [checkboxConfigs]="noDuplicatesList['DPADULT']"
                    formControlName="doNotAllowDuplicateAttribute"
                    groupAlignment="horizontal"
                    [colorTheme]="colorTheme"
                  ></cb-multi-checkbox>
                </div>
              </div>
            </div>
          </div>
        </p-accordionTab>
      </p-accordion>
    </div>

    <div class="insured-type__custom-attributes-wrapper">
      <div class="insured-type__tooltip" *ngIf="formArray.length > 0">
        <div class="insured-type__custom-attributes-title">
          Custom attributes
        </div>
        <div class="insured-type__tooltiptext">
          <cb-tooltip
            explanationText="Unique characteristics/attributes of the insured which further define the insured, product eligibility, & pricing."
            styleVariant="stroke"
            [colorTheme]="cbToolTipColorTheme"
            direction="above-right"
          >
            <cb-icon iconKey="utility-tooltip-stroke"></cb-icon>
          </cb-tooltip>
        </div>
      </div>
      <div formGroupName="customAttributesForm">
        <div
          formArrayName="attributes"
          class="insured-type__custom-attributes-form-array"
          *ngFor="let attribute of formArray.controls; let i = index"
        >
          <div
            [formGroupName]="i"
            class="insured-type__custom-attributes-form-group"
          >
            <div class="insured-type__custom-attributes-form-title-wrapper">
              <div class="insured-type__custom-attributes-form-title">
                {{ 'Attribute ' + (i + 1) }}
              </div>
              <cb-icon
                class="insured-type__custom-attributes-form-group__delete"
                iconKey="utility-trash-fill"
                iconColor="error-saturated"
                [iconSize]="cbIconSize.LARGE"
                [addPointerClass]="true"
                *ngIf="
                  formArray.length > 0 &&
                  disableDel.length > 0 &&
                  !disableDel[i]
                "
                (click)="enableDeleteConfirmation(i)"
                [disabled]="disableDel[i]"
              ></cb-icon>
            </div>
            <div class="insured-type__custom-attributes-form-checkbox">
              <div cbCheckbox [colorTheme]="colorTheme">
                <input
                  class="insured-type__custom-attributes-form-checkbox-text"
                  type="checkbox"
                  formControlName="required"
                />
                <label>Required</label>
              </div>
              <div cbCheckbox [colorTheme]="colorTheme">
                <input
                  class="insured-type__custom-attributes-form-checkbox-text"
                  type="checkbox"
                  formControlName="doNotAllowDuplicate"
                />
                <label>Do not allow duplication</label>
              </div>
            </div>
            <div
              cbInput
              label="Attribute name"
              styleVariant="default"
              [errorMessage]="
                getCustAttributeNameErrorMessage(
                  formArray.controls[i].get('name'),
                  formArray.controls[i].get('dataType')
                )
              "
            >
              <input
                placeholder="Attribute name"
                type="text"
                formControlName="name"
                maxLength="700"
              />
            </div>
            <div
              styleVariant="default"
              placeholder="Data type"
              class="cb-select-choice"
            >
              <label class="cb-input__label">Data type *</label>
              <select
                [disabled]="false"
                name="options"
                id="options"
                formControlName="dataType"
                class="cb-select-choice__base-select cb-select-choice__custom-select"
                (change)="fileTypeChanged(i)"
              >
                <option
                  [ngValue]="type.code"
                  *ngFor="let type of dataTypes"
                  [selected]="
                    type.code === formArray.controls[i].get('dataType')?.value
                  "
                >
                  {{ type.description }}
                </option>
              </select>
            </div>
            <div
              formArrayName="answers"
              *ngIf="
                formArray.controls[i].get('dataType')?.value === 'DROPDOWN'
              "
            >
              <div class="insured-type__custom-attributes-title">DROPDOWN</div>
              <div
                *ngFor="
                  let answer of getAnswersControls(i).controls;
                  let j = index
                "
                [formGroupName]="j"
              >
                <div class="insured-type__custom-attributes-form-title-wrapper">
                  <div class="insured-type__custom-attributes-form-title">
                    {{ 'Answer ' + (j + 1) }}
                  </div>
                  <cb-icon
                    class="insured-type__custom-attributes-form-group__delete"
                    iconKey="utility-trash-fill"
                    iconColor="error-saturated"
                    [iconSize]="cbIconSize.LARGE"
                    [addPointerClass]="true"
                    (click)="removeAnswer(getAttribute(i), j)"
                    [ngClass]="{ disabled: disableEdit }"
                  ></cb-icon>
                </div>
                <div
                  cbInput
                  label="Answer value"
                  styleVariant="default"
                  [errorMessage]="
                    getDropdownAnswerErrorMessage(answer.get('answerValue'))
                  "
                >
                  <input
                    formControlName="answerValue"
                    placeholder="Answer Value"
                    type="text"
                  />
                </div>
                <div
                  cbInput
                  label="Answer description"
                  styleVariant="default"
                  [errorMessage]="
                    getDropdownAnswerErrorMessage(
                      answer.get('answerDescription')
                    )
                  "
                >
                  <input
                    formControlName="answerDescription"
                    placeholder="Answer Description"
                    type="text"
                  />
                </div>
              </div>
              <button
                class="insured-type__custom-attributes-answer-title"
                (click)="addAnswer(getAttribute(i))"
                [ngClass]="{ disabled: disableEdit }"
              >
                + Add fields
              </button>
            </div>
            <div
              *ngIf=" formArray.controls[i].get('dataType')?.invalid && (formArray.controls[i].get('dataType')?.dirty || formArray.controls[i].get('dataType')?.touched) && formArray.controls[i].get('dataType')?.errors?.['required']"
            >
              <div class="error-text-container">
                <cb-icon
                  iconKey="utility-error-stroke"
                  iconColor="error-shade"
                  [iconSize]="cbIconSize.REGULAR"
                  [addPointerClass]="false"
                ></cb-icon>
                <div class="error-text-container__error-text">
                  Required field
                </div>
              </div>
            </div>
            <div
              *ngIf="formArray.controls[i].get('dataType')?.value === 'FILE'"
            >
              <div
                cbInput
                label="Maximum count"
                styleVariant="default"
                [errorMessage]="formArray.controls[i].get('maxOccurence')?.invalid && (formArray.controls[i].get('maxOccurence')?.dirty || formArray.controls[i].get('maxOccurence')?.touched) ? formArray.controls[i].get('maxOccurence')?.errors?.['maxlength'] ? 'Data cannot be more than 100' : 'Required field' : null"
              >
                <input
                  placeholder="Maximum count"
                  type="number"
                  pattern=".*"
                  maxLength="2"
                  formControlName="maxOccurence"
                />
              </div>
              <div
                class="insured-type__main-insured-select"
                [cbSelectMultiple]="selectMultipleFiletype"
              >
                <label class="insured-type__main-insured-label"
                  >File type</label
                >
                <p-multiSelect
                  #selectMultipleFiletype
                  [selectAll]="selectAllFileTypes[i]"
                  [options]="fileTypes"
                  optionLabel="description"
                  placeholder="File types"
                  formControlName="fileTypes"
                  inputId="#selectMultipleFiletype"
                  (onSelectAllChange)="selectAllFileType(i, $event)"
                ></p-multiSelect>
              </div>
            </div>
            <div cbInput
              label="Default value"
              styleVariant="default"
              *ngIf="!(formArray.controls[i].get('dataType')?.value === 'DROPDOWN' || formArray.controls[i].get('dataType')?.value === 'FILE')">
              <input
                  placeholder="Enter default value"
                  type="text"
                  formControlName="defaultValue"/>
            </div>
          </div>
        </div>
        <div class="insured-type__custom-attributes-form-action-button">
          <button
            cbButton
            label="Add custom attribute"
            [leftIcon]="'utility-add'"
            variant="ghost"
            [colorTheme]="colorTheme"
            (click)="addAttribute()"
            [disabled]="disableAdd"
          ></button>
        </div>
      </div>
    </div>

    <div class="insured-type__footer-buttons">
      <div class="insured-type__footer-buttons--left">
        <button
          cbButton
          label="Back"
          [leftIcon]="'utility-arrow-left'"
          variant="ghost"
          (click)="previous()"
        ></button>
      </div>
      <div class="insured-type__footer-buttons--right">
        <button
          cbButton
          label="Save & exit"
          variant="secondary"
          [colorTheme]="colorTheme"
          (click)="saveAndExit()"
          [disabled]="disableEdit"
        ></button>
        <button
          cbButton
          label="Save changes"
          variant="primary"
          [colorTheme]="colorTheme"
          (click)="saveAndNext()"
          *ngIf="!disableEdit"
        ></button>
        <button
          cbButton
          label="Next"
          variant="primary"
          [colorTheme]="colorTheme"
          (click)="submit()"
          *ngIf="disableEdit"
        ></button>
      </div>
    </div>
  </form>
</div>

<cb-modal
  [open]="openDeleteModal"
  (closeEvent)="handleDeleteModal()"
  [title]="deleteModalTitle"
  message=""
  [hideCloseIcon]="false"
>
  <div class="insured-type__modal-button-wrapper">
    <button
      cbButton
      label="Cancel"
      variant="secondary"
      (click)="handleDeleteModal()"
    ></button>
    <button
      cbButton
      label="Yes"
      variant="primary"
      colorTheme="default"
      (click)="deleteConfirmation()"
    ></button>
  </div>
</cb-modal>

<cb-modal
  [open]="openDeleteAttributeModal"
  (closeEvent)="handleDeleteAttributeModal()"
  title="Do you want to delete the custom attribute option?"
  message=""
  [hideCloseIcon]="false"
>
  <div class="insured-type__modal-button-wrapper">
    <button
      cbButton
      label="Cancel"
      variant="secondary"
      (click)="handleDeleteAttributeModal()"
    ></button>
    <button
      cbButton
      label="Yes"
      variant="primary"
      colorTheme="default"
      (click)="deleteAttributeConfirmation()"
    ></button>
  </div>
</cb-modal>
